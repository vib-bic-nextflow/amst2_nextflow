profiles{
conda { 
    conda{
        enabled= true
    }
    }

apptainer_wsl {
    apptainer{
            enabled=true //set to true
            autoMounts=true //set to true
            containerOptions='-B /home/tatiana/test_data'  
    } 
}

apptainer_tier1_cpu{
    // singularity {}, 
    apptainer{ 
        enabled=true
        autoMounts=true
        cacheDir = '/scratch/gent/vo/001/gvo00163/vsc34840/.apptainer/cache'
        tmpDir = '/scratch/gent/vo/001/gvo00163/vsc34840/.apptainer/tmp'
    }
}
}

params {
// for AMST2
    base_dir_hpc_tier1="/dodrio/scratch/projects/2024_300/twoller/"
    yaml_prealign = "${params.base_dir_hpc_tier1}/input_amst/params-prealign.yaml"
    yaml_amst= "${params.base_dir_hpc_tier1}/input_amst/params-amst.yaml"
    outdir = "${params.base_dir_hpc_tier1}/results/EM_workflow"
    workers=8
    output_extension = '{tif,tiff,json}'

// for prepare
    n_training_crops = "10"
    n_validation_crops = "2"
    crop_size = "256"
    max_zero_fraction = "0.3"
    file_extension='tif'

  //  custom_config_version      = 'master'
  //  custom_config_base         = "https://raw.githubusercontent.com/nf-core/configs/${params.custom_config_version}"
}

//includeConfig !System.getenv('NXF_OFFLINE') && params.custom_config_base ? "${params.custom_config_base}/nfcore_custom.config" : "/dev/null"

process {
    withName: 'AMST2_PREALIGN' {
        publishDir = [
            path: "${params.outdir}/pre_align",
            mode: 'copy'
        ]
        time = '1.h'
        clusterOptions= "--account=2024_300  --partition=cpu_rome  --ntasks=1 --cpus-per-task=8 --mem=8GB"
        executor= 'slurm'
    }
    withName: 'AMST2_AMST' {
        publishDir = [
            path: "${params.outdir}/amst",
            mode: 'copy'
        ]
        memory = '4.GB'
        time = '1.h'
        executor= 'slurm'
        clusterOptions= "--account=2024_300  --partition=cpu_rome  --ntasks=1 --cpus-per-task=8 --mem=16GB"
    }
    withName: 'PREPARE_DATA' {
    memory = '2 GB'
    cpus   = 4
    publishDir = [
            path: "${params.outdir}/prepare",
            mode: 'copy',
            pattern: "{*.tif,*.csv}"
        ]
    executor= 'local'
    clusterOptions= "--account=2024_300  --partition=cpu_rome  --ntasks=1 --cpus-per-task=8 --mem=2GB"
}

}
